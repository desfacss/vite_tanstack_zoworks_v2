# i18n — Internationalization System

> Lazy-loaded, tenant-aware translation system for multi-language enterprise apps.

---

## Architecture Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                      i18n INITIALIZATION                         │
│  initI18n(enabledLanguages, defaultLanguage)                    │
│  - Called once at app bootstrap                                  │
│  - Loads ONLY tenant-enabled languages                          │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                      CORE TRANSLATIONS                           │
│  src/core/i18n/locales/{lang}.json                              │
│  - Loaded at bootstrap                                           │
│  - Contains: common.*, core.*                                    │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                      MODULE TRANSLATIONS                         │
│  src/modules/{module}/i18n/{lang}.json                          │
│  - Loaded when module registers                                  │
│  - Lazy imported via registerModuleTranslations()               │
└─────────────────────────────────────────────────────────────────┘
```

---

## File Structure

```
src/
├── core/i18n/
│   ├── index.ts              # i18n system (initialization, utilities)
│   └── locales/
│       ├── en.json           # English (fallback)
│       ├── fr.json           # French
│       ├── hi.json           # Hindi
│       ├── kn.json           # Kannada
│       ├── ta.json           # Tamil
│       ├── te.json           # Telugu
│       └── mr.json           # Marathi
│
├── modules/{module}/i18n/
│   ├── en.json               # Module-specific English
│   └── ...                   # Other languages
│
└── i18n/
    └── index.ts              # Re-export (barrel file)
```

---

## Supported Languages

| Code | Language | Script | RTL |
|------|----------|--------|-----|
| `en` | English | Latin | No |
| `fr` | French | Latin | No |
| `hi` | Hindi | Devanagari | No |
| `kn` | Kannada | Kannada | No |
| `ta` | Tamil | Tamil | No |
| `te` | Telugu | Telugu | No |
| `mr` | Marathi | Devanagari | No |
| `ar` | Arabic | Arabic | **Yes** |

**RTL Support:**
```typescript
const RTL_LANGUAGES = ['ar', 'he', 'fa', 'ur'];

function applyTextDirection(lang: string): void {
  const isRTL = RTL_LANGUAGES.includes(lang);
  document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
  document.documentElement.lang = lang;
}
```

---

## Initialization

### Bootstrap (App Entry)

```typescript
import { initI18n } from '@/core/i18n';

// During app bootstrap, after tenant config is loaded
await initI18n(
  ['en', 'hi', 'kn'],  // Tenant-enabled languages
  'en'                  // Default language
);
```

### What Happens:
1. Initialize i18next with empty resources
2. Load ONLY enabled core languages (lazy import)
3. Respect user's saved preference (localStorage)
4. Set dayjs locale
5. Apply RTL direction if needed

---

## Module Registration

Each module registers its translations when mounting:

```typescript
// src/modules/tickets/registry.ts
import { registerModuleTranslations } from '@/core/i18n';

export async function register(config, enabledLanguages) {
  // Register translations FIRST
  await registerModuleTranslations('tickets', {
    en: () => import('./i18n/en.json'),
    hi: () => import('./i18n/hi.json'),
    kn: () => import('./i18n/kn.json'),
  }, enabledLanguages);

  // Then register tabs, actions, etc.
}
```

### Key Points:
- Uses namespace = module ID (e.g., `'tickets'`)
- Only loads languages enabled for the tenant
- Prevents duplicate loads via `loadedNamespaces` Set

---

## Key Naming Convention

Keys follow a hierarchical **Domain-Driven** structure:

```
[namespace].[module/component].[context].[element]
```

### Structure:

| Part | Description | Examples |
|------|-------------|----------|
| **namespace** | `common`, `core`, or `modules` | |
| **module/component** | Functional area | `auth`, `settings`, `tickets` |
| **context** | Intent category | `label`, `action`, `message`, `status` |
| **element** | Specific key (snake_case) | `save`, `created_at`, `login_success` |

### Context Types:

| Context | Purpose | Example |
|---------|---------|---------|
| `label` | Static text, headers, titles | `common.label.name` |
| `action` | Buttons, menu items | `common.action.save` |
| `message` | User feedback (success/error) | `common.message.save_success` |
| `status` | State indicators | `common.status.active` |
| `placeholder` | Input hints | `core.auth.placeholder.email` |
| `tip` | Help text, tooltips | |

### Examples:

```typescript
// Common reusable
t('common.action.save')           // "Save"
t('common.label.created_at')      // "Created At"
t('common.message.save_success')  // "Saved successfully"

// Core module
t('core.auth.label.title')        // "Welcome Back"
t('core.auth.action.sign_in')     // "Sign In"
t('core.settings.label.theme_mode') // "Theme Mode"

// Business module (namespaced)
t('tickets:tabs.summary')         // Module-specific tab label
t('crm:contacts.label.first_name') // Module-specific field
```

---

## JSON Structure

### Core Translations (`en.json`):

```json
{
  "translation": {
    "common": {
      "label": {
        "name": "Name",
        "email": "Email",
        "loading": "Loading...",
        "no_data": "No Data Available"
      },
      "action": {
        "save": "Save",
        "cancel": "Cancel",
        "delete": "Delete"
      },
      "message": {
        "save_success": "Saved successfully",
        "save_failed": "Save failed"
      },
      "status": {
        "active": "Active",
        "inactive": "Inactive"
      }
    },
    "core": {
      "auth": {
        "label": { "title": "Welcome Back" },
        "action": { "sign_in": "Sign In" },
        "message": { "login_success": "Login successful!" }
      },
      "settings": {
        "label": { "theme_mode": "Theme Mode" }
      }
    }
  }
}
```

### Module Translations (`tickets/i18n/en.json`):

```json
{
  "tabs": {
    "summary": "Summary",
    "messages": "Messages"
  },
  "label": {
    "priority": "Priority",
    "assignee": "Assignee"
  },
  "action": {
    "create": "Create Ticket"
  }
}
```

---

## API Reference

### Initialization

```typescript
// Initialize with tenant languages
await initI18n(enabledLanguages: string[], defaultLanguage?: string): Promise<void>

// Register module translations
await registerModuleTranslations(
  moduleId: string,
  languageImports: Record<string, () => Promise<object>>,
  enabledLanguages?: string[]  // Defaults to tenant languages
): Promise<void>
```

### Language Utilities

```typescript
// Change language
await changeLanguage(lang: string): Promise<void>

// Get enabled languages for current tenant
getEnabledLanguages(): string[]

// Check if language is enabled
isLanguageEnabled(lang: string): boolean

// Get display names for language selector
getLanguageDisplayNames(): Record<string, string>
// Returns: { 'en': 'English', 'hi': 'हिन्दी (Hindi)', ... }
```

---

## Usage in Components

```tsx
import { useTranslation } from 'react-i18next';

const MyComponent = () => {
  const { t } = useTranslation();

  return (
    <div>
      <h1>{t('common.label.dashboard')}</h1>
      <button>{t('common.action.save')}</button>
      <span>{t('common.message.save_success')}</span>
    </div>
  );
};

// With module namespace
const TicketsComponent = () => {
  const { t } = useTranslation('tickets');

  return <span>{t('tabs.summary')}</span>;
};
```

---

## dayjs Integration

Locale automatically syncs with i18n:

```typescript
import dayjs from 'dayjs';

// On language change
i18next.on('languageChanged', (lng) => {
  dayjs.locale(lng);
});

// Usage
dayjs(date).format('LL')  // Localized date format
```

---

## Common Key Reference

| Element | Key | Value (en) |
|---------|-----|------------|
| Save button | `common.action.save` | Save |
| Cancel button | `common.action.cancel` | Cancel |
| Delete button | `common.action.delete` | Delete |
| Name field | `common.label.name` | Name |
| Email field | `common.label.email` | Email |
| Loading state | `common.label.loading` | Loading... |
| No data | `common.label.no_data` | No Data Available |
| Success message | `common.message.save_success` | Saved successfully |
| Error message | `common.message.save_failed` | Save failed |
| Active status | `common.status.active` | Active |
| Inactive status | `common.status.inactive` | Inactive |

---

## Best Practices

1. **Never hardcode strings** — Always use `t()` calls
2. **Reuse common keys** — Check `common.*` before creating new keys
3. **Lazy load module translations** — Register in module's `registry.ts`
4. **Use interpolation** for dynamic values:
   ```typescript
   t('common.message.switching_to', { name: 'Org Name' })
   // "Switching to Org Name..."
   ```
5. **Handle plurals** at key level:
   ```json
   {
     "item_one": "{{count}} item",
     "item_other": "{{count}} items"
   }
   ```

---

## Implementation Checklist

- [x] Lazy loading via dynamic imports
- [x] Tenant-enabled language filtering
- [x] Module namespace registration
- [x] RTL support (ar, he, fa, ur)
- [x] dayjs locale sync
- [x] Language persistence (localStorage)
- [x] Fallback to 'en'

---

*Last Updated: 2025-12-25*
*Source: `src/core/i18n/index.ts`*
